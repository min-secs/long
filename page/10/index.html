<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Boom.Tan个人空间">
<meta property="og:url" content="http://example.com/page/10/index.html">
<meta property="og:site_name" content="Boom.Tan个人空间">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="boom.Tan">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/10/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Boom.Tan个人空间</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Boom.Tan个人空间</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">101</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/02/06/%E8%BD%A6%E6%9C%BA/Android-mk%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="boom.Tan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Boom.Tan个人空间">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/06/%E8%BD%A6%E6%9C%BA/Android-mk%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">Android.mk</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-06 08:35:05" itemprop="dateCreated datePublished" datetime="2020-02-06T08:35:05+08:00">2020-02-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-03-06 11:35:35" itemprop="dateModified" datetime="2021-03-06T11:35:35+08:00">2021-03-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BD%A6%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">车机</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>Android源码编译不同的版本,略微有不同<br>如下基于9.0</p>
</blockquote>
<p>编写app之前,确认编译环境使用的sdk版本,在build.gradle中配置成一样的<br>删掉不需要用的东西,也许某个虚线下面在编译时就是一个炸弹</p>
<p>一个apk构依赖部分<br>系统属性/自己项目的module/第三方jar/第三方aar/so库</p>
<ul>
<li><h4 id="系统预编译好的属性"><a href="#系统预编译好的属性" class="headerlink" title="系统预编译好的属性"></a>系统预编译好的属性</h4>如AndroidX系列,<br>implementation ‘androidx.constraintlayout:constraintlayout:1.1.0<br>可在编译目录中通过查找对应 name属性<br><code>find prebuilts/sdk/ -name Android.bp|xargs grep &quot;name.*constraintlayout&quot;</code></li>
</ul>
<p>mk如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">LOCAL_PATH:&#x3D; $(call my-dir)</span><br><span class="line">include $(CLEAR_VARS)</span><br><span class="line">LOCAL_USE_AAPT2 :&#x3D; true</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">LOCAL_STATIC_ANDROID_LIBRARIES :&#x3D; \ androidx-constraintlayout_constraintlayout</span><br><span class="line"></span><br><span class="line">include $(BUILD_PACKAGE)</span><br></pre></td></tr></table></figure>
<ul>
<li><h4 id="依赖自己项目中Module"><a href="#依赖自己项目中Module" class="headerlink" title="依赖自己项目中Module"></a>依赖自己项目中Module</h4></li>
</ul>
<p>1.只依赖java文件,即常用的jar包<br>module中配置Android.bp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">java_library &#123;</span><br><span class="line">    name: &quot;constantproxy&quot;,</span><br><span class="line"></span><br><span class="line">    srcs: [</span><br><span class="line">        &quot;src&#x2F;main&#x2F;java&#x2F;**&#x2F;*.java&quot;,</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    exclude_srcs: [</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    libs: [</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    static_libs: [</span><br><span class="line">        &quot;androidx.media_media&quot;, &#x2F;&#x2F;依赖的系统属性</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    required: [</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    dxflags: [</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>app中Android.mk</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">LOCAL_PATH :&#x3D; $(call my-dir)</span><br><span class="line">include $(CLEAR_VARS)</span><br><span class="line">LOCAL_USE_AAPT2 :&#x3D; true</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">LOCAL_STATIC_JAVA_LIBRARIES :&#x3D; \</span><br><span class="line">							   constantproxy\</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>2.既依赖java又依赖res<br>此种module不需要写mk<br>在app中引入即可</p>
<blockquote>
<p>? 理论上是不是每个module都可以这么写</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">LOCAL_PATH:&#x3D; $(call my-dir)</span><br><span class="line">include $(CLEAR_VARS)</span><br><span class="line">LOCAL_USE_AAPT2 :&#x3D; true</span><br><span class="line"></span><br><span class="line">LOCAL_MODULE_TAGS :&#x3D; optional</span><br><span class="line"></span><br><span class="line">LOCAL_SRC_FILES :&#x3D; $(call all-java-files-under, src)</span><br><span class="line">LOCAL_SRC_FILES +&#x3D; $(call all-java-files-under, yourmodule&#x2F;src)</span><br><span class="line">LOCAL_RESOURCE_DIR +&#x3D; $(LOCAL_PATH)&#x2F;src&#x2F;main&#x2F;res</span><br><span class="line">LOCAL_RESOURCE_DIR +&#x3D; $(LOCAL_PATH)&#x2F;yourmodule&#x2F;src&#x2F;main&#x2F;res</span><br><span class="line">#注意yourmodule路径的准确性</span><br><span class="line"></span><br><span class="line">LOCAL_AAPT_FLAGS :&#x3D; --auto-add-overlay \</span><br><span class="line">                                      --extra-packages yourmodule包名 \</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">include $(BUILD_PACKAGE)</span><br></pre></td></tr></table></figure>
<ul>
<li><h4 id="第三方jar"><a href="#第三方jar" class="headerlink" title="第三方jar"></a>第三方jar</h4>在jar的同级目录下新建Androd.bp 如libs/Android.bp<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">java_import &#123;</span><br><span class="line">    name: &quot;my_jar&quot;,</span><br><span class="line">    jars: [&quot;annotation-1.1.0.jar&quot;],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
如果依赖第三方jar的是库,则在库里面的Android.bp中<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">java_library &#123;</span><br><span class="line">    name: &quot;my_lib_core&quot;,</span><br><span class="line"></span><br><span class="line">    srcs: [</span><br><span class="line">        &quot;src&#x2F;main&#x2F;java&#x2F;**&#x2F;*.java&quot;,</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    exclude_srcs: [</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    libs: [</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    static_libs: [</span><br><span class="line">        &quot;androidx.appcompat_appcompat&quot;,&quot;my_jar&quot;</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    required: [</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    dxflags: [</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
如果是自己的项目,则在app中Android.mk<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">LOCAL_PATH:&#x3D; $(call my-dir)</span><br><span class="line">include $(CLEAR_VARS)</span><br><span class="line">LOCAL_USE_AAPT2 :&#x3D; true</span><br><span class="line">LOCAL_STATIC_JAVA_LIBRARIES :&#x3D; \</span><br><span class="line">                my_jar \</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">LOCAL_PRIVATE_PLATFORM_APIS :&#x3D; true</span><br><span class="line">include $(BUILD_PACKAGE)</span><br></pre></td></tr></table></figure></li>
<li><h4 id="依赖第三方aar"><a href="#依赖第三方aar" class="headerlink" title="依赖第三方aar"></a>依赖第三方aar</h4>在aar同级目录Android.bp中<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">android_library_import &#123;</span><br><span class="line">    name: &quot;navigation-fragment-nodeps&quot;,</span><br><span class="line">    aars: [&quot;libs&#x2F;navigation-fragment-2.3.0-alpha01.aar&quot;],</span><br><span class="line">    sdk_version: &quot;current&quot;,</span><br><span class="line">    static_libs: [</span><br><span class="line">		&quot;androidx.fragment_fragment&quot;, &#x2F;&#x2F;navigation-fragment依赖androidx.fragment_fragment</span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">android_library &#123;</span><br><span class="line">    name: &quot;androidx.navigation_navigation-fragment&quot;,</span><br><span class="line">    sdk_version: &quot;current&quot;,</span><br><span class="line">    manifest: &quot;androidx.navigation.fragment&#x2F;AndroidManifest.xml&quot;,</span><br><span class="line">    static_libs: [</span><br><span class="line">        &quot;navigation-fragment-nodeps&quot;,</span><br><span class="line">		&quot;androidx.fragment_fragment&quot;,</span><br><span class="line">    ],</span><br><span class="line">    java_version: &quot;1.8&quot;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
在Android.mk中<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LOCAL_STATIC_ANDROID_LIBRARIES :&#x3D; \</span><br><span class="line">                    androidx.navigation_navigation-fragment</span><br></pre></td></tr></table></figure></li>
<li><h4 id="so库"><a href="#so库" class="headerlink" title="so库"></a>so库</h4><blockquote>
<p>此so库指的是NDK编译出来的so库,libs下直接可用<br>需要用到so库的mk里面</p>
</blockquote>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">include $(BUILD_PACKAGE)</span><br><span class="line"></span><br><span class="line">libs_dir :&#x3D; $(TARGET_OUT)&#x2F;app&#x2F;yourapkname&#x2F;lib&#x2F;armeabi</span><br><span class="line">$(shell mkdir -p $(libs_dir))</span><br><span class="line">src_files :&#x3D; $(shell ls $(LOCAL_PATH)&#x2F;libs&#x2F;armeabi&#x2F;)</span><br><span class="line">$(foreach file, $(src_files),\</span><br><span class="line">			    $(shell cp $(LOCAL_PATH)&#x2F;libs&#x2F;armeabi&#x2F;$(file) $(libs_dir)&#x2F;$(file)))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<p>Android9.0源码中的mk例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">LOCAL_PATH:&#x3D; $(call my-dir)</span><br><span class="line"> </span><br><span class="line">include $(CLEAR_VARS)</span><br><span class="line"> </span><br><span class="line">LOCAL_USE_AAPT2 :&#x3D; true</span><br><span class="line">LOCAL_PACKAGE_NAME :&#x3D; APK名字</span><br><span class="line">LOCAL_OVERRIDES_PACKAGES :&#x3D; </span><br><span class="line">LOCAL_MODULE_TAGS :&#x3D; optional</span><br><span class="line"> </span><br><span class="line"># can&#39;t use LOCAL_SDK_VERSION, otherwise the error will occur like this:</span><br><span class="line"># &quot;(java:sdk) should not link to&quot;</span><br><span class="line">#LOCAL_SDK_VERSION :&#x3D; current</span><br><span class="line">LOCAL_PRIVATE_PLATFORM_APIS :&#x3D; true</span><br><span class="line">LOCAL_PRIVILEGED_MODULE :&#x3D; true</span><br><span class="line">LOCAL_JAVACFLAGS :&#x3D; -Xlint:deprecation -Xlint:unchecked</span><br><span class="line"> </span><br><span class="line">#LOCAL_PROGUARD_FLAG_FILES :&#x3D; proguard.flags</span><br><span class="line">#LOCAL_JARJAR_RULES :&#x3D; $(LOCAL_PATH)&#x2F;jarjar-rules.txt</span><br><span class="line"> </span><br><span class="line">###################################################</span><br><span class="line"># src, res, AndroidManifest.xml ...</span><br><span class="line">###################################################</span><br><span class="line">LOCAL_MANIFEST_FILE :&#x3D; src&#x2F;main&#x2F;AndroidManifest.xml</span><br><span class="line">LOCAL_SRC_FILES :&#x3D; $(call all-java-files-under, src&#x2F;main&#x2F;java)</span><br><span class="line">LOCAL_RESOURCE_DIR :&#x3D; $(LOCAL_PATH)&#x2F;src&#x2F;main&#x2F;res</span><br><span class="line">LOCAL_ASSET_DIR :&#x3D; $(LOCAL_PATH)&#x2F;src&#x2F;main&#x2F;assets</span><br><span class="line"> </span><br><span class="line">###################################################</span><br><span class="line"># AS dependencies from androidx or android-support</span><br><span class="line">###################################################</span><br><span class="line">#implementation &#39;androidx.appcompat:appcompat:1.0.0&#39;</span><br><span class="line">#LOCAL_STATIC_ANDROID_LIBRARIES +&#x3D; androidx.appcompat_appcompat</span><br><span class="line"> </span><br><span class="line">#implementation &#39;androidx.constraintlayout:constraintlayout:1.1.0&#39;</span><br><span class="line">#LOCAL_STATIC_ANDROID_LIBRARIES +&#x3D; androidx-constraintlayout_constraintlayout</span><br><span class="line"> </span><br><span class="line">#implementation &#39;androidx.recyclerview:recyclerview:1.0.0&#39;</span><br><span class="line">#LOCAL_STATIC_ANDROID_LIBRARIES +&#x3D; androidx.recyclerview_recyclerview</span><br><span class="line"> </span><br><span class="line">#implementation &#39;com.google.android.material:material:1.0.0&#39;</span><br><span class="line">#LOCAL_STATIC_ANDROID_LIBRARIES +&#x3D; com.google.android.material_material</span><br><span class="line"> </span><br><span class="line">###################################################</span><br><span class="line"># custom aar library</span><br><span class="line">###################################################</span><br><span class="line">#LOCAL_STATIC_JAVA_AAR_LIBRARIES +&#x3D; 第三方AAR的别名，如：Demo_xxx-1.0.0</span><br><span class="line">#LOCAL_AAPT_FLAGS +&#x3D; --extra-packages 第三方AAR里面AndroidManifest.xml定义的包名</span><br><span class="line">#LOCAL_RESOURCE_DIR +&#x3D; 如果第三方AAR里面有res编不过的时候可以将res解压出来在此引用，如：$(LOCAL_PATH)&#x2F;libs&#x2F;xxx&#x2F;res</span><br><span class="line">LOCAL_AAPT_FLAGS +&#x3D; --auto-add-overlay</span><br><span class="line"> </span><br><span class="line">###################################################</span><br><span class="line"># custom jar library</span><br><span class="line">###################################################</span><br><span class="line">#LOCAL_STATIC_JAVA_LIBRARIES +&#x3D; 自定义Module或第三方JAR的别名</span><br><span class="line">#LOCAL_JAVA_LIBRARIES +&#x3D;</span><br><span class="line"> </span><br><span class="line">###################################################</span><br><span class="line"># custom jni library</span><br><span class="line">###################################################</span><br><span class="line">LOCAL_JNI_SHARED_LIBRARIES :&#x3D; </span><br><span class="line"> </span><br><span class="line">include $(BUILD_PACKAGE)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">##############################################################</span><br><span class="line"># Pre-built dependency jars,aars,...</span><br><span class="line">##############################################################</span><br><span class="line">include $(CLEAR_VARS)</span><br><span class="line"> </span><br><span class="line">#LOCAL_PREBUILT_STATIC_JAVA_LIBRARIES +&#x3D; AAR或JAR别名与文件路径对应关系，如：Demo_xxx-1.0.0:libs&#x2F;xxx&#x2F;xxx.aar</span><br><span class="line"> </span><br><span class="line">include $(BUILD_MULTI_PREBUILT)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">##############################################################</span><br><span class="line"># Pre-built dependency jars,aars,...</span><br><span class="line">##############################################################</span><br><span class="line">#prebuilts +&#x3D; xxx:libs&#x2F;xxx&#x2F;xxx.aar</span><br><span class="line">#</span><br><span class="line">#define define-prebuilt</span><br><span class="line">#  $(eval tw :&#x3D; $(subst :, ,$(strip $(1)))) \</span><br><span class="line">#  $(eval include $(CLEAR_VARS)) \</span><br><span class="line">#  $(eval LOCAL_MODULE :&#x3D; $(word 1,$(tw))) \</span><br><span class="line">#  $(eval LOCAL_MODULE_TAGS :&#x3D; optional) \</span><br><span class="line">#  $(eval LOCAL_MODULE_CLASS :&#x3D; JAVA_LIBRARIES) \</span><br><span class="line">#  $(eval LOCAL_SRC_FILES :&#x3D; $(word 2,$(tw))) \</span><br><span class="line">#  $(eval LOCAL_UNINSTALLABLE_MODULE :&#x3D; true) \</span><br><span class="line">#  $(eval LOCAL_SDK_VERSION :&#x3D; system_current) \</span><br><span class="line">#  $(eval include $(BUILD_PREBUILT))</span><br><span class="line">#endef</span><br><span class="line">#</span><br><span class="line">#$(foreach p,$(prebuilts),\</span><br><span class="line">#  $(call define-prebuilt,$(p)))</span><br><span class="line">#</span><br><span class="line">#prebuilts :&#x3D;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">##############################################################</span><br><span class="line"># find other Android.mk </span><br><span class="line">##############################################################</span><br><span class="line">include $(call all-makefiles-under, $(LOCAL_PATH))</span><br></pre></td></tr></table></figure>
<hr>
<p>上面的方式都不行的话,直接打包apk编译<br>xx.apk同级目录Android.mk</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">LOCAL_PATH :&#x3D; $(call my-dir)</span><br><span class="line">include $(CLEAR_VARS)</span><br><span class="line"></span><br><span class="line">LOCAL_MODULE :&#x3D; weixin</span><br><span class="line">LOCAL_MODULE_CLASS :&#x3D; APPS</span><br><span class="line">LOCAL_MODULE_SUFFIX :&#x3D; $(COMMON_ANDROID_PACKAGE_SUFFIX)</span><br><span class="line">LOCAL_SRC_FILES :&#x3D; $(LOCAL_MODULE).apk</span><br><span class="line">LOCAL_MODULE_PATH :&#x3D; $(TARGET_OUT_APP)</span><br><span class="line">LOCAL_CERTIFICATE :&#x3D; platform</span><br><span class="line">include $(BUILD_PREBUILT)</span><br><span class="line">include $(call all-makefiles-under,$(LOCAL_PATH))</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/02/06/%E8%BD%A6%E6%9C%BA/Eclipse%E9%81%87%E5%88%B0%E7%9A%84%E9%94%99%E8%AF%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="boom.Tan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Boom.Tan个人空间">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/06/%E8%BD%A6%E6%9C%BA/Eclipse%E9%81%87%E5%88%B0%E7%9A%84%E9%94%99%E8%AF%AF/" class="post-title-link" itemprop="url">Eclipse遇到的错误</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-06 08:35:05" itemprop="dateCreated datePublished" datetime="2020-02-06T08:35:05+08:00">2020-02-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-03-06 11:35:43" itemprop="dateModified" datetime="2021-03-06T11:35:43+08:00">2021-03-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BD%A6%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">车机</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Q1-Conversion-to-Dalvik-format-failed-Unable-to-execute-dex-Multiple-dex-files-define-L"><a href="#Q1-Conversion-to-Dalvik-format-failed-Unable-to-execute-dex-Multiple-dex-files-define-L" class="headerlink" title="Q1 Conversion to Dalvik format failed: Unable to execute dex: Multiple dex files define L"></a>Q1 Conversion to Dalvik format failed: Unable to execute dex: Multiple dex files define L</h3><p>A1：添加的jar包重复了，可能名字不同，里面的内容相同。这点就做的不好了，提示不出来哪两个文件相同。</p>
<h3 id="Q2-Unknown-exception-in-parseSdkContent-java-lang-StackOverflowError"><a href="#Q2-Unknown-exception-in-parseSdkContent-java-lang-StackOverflowError" class="headerlink" title="Q2 Unknown exception in parseSdkContent. java.lang.StackOverflowError"></a>Q2 Unknown exception in parseSdkContent. java.lang.StackOverflowError</h3><p>A2:主工程A  Lib (B C) BC之间相互依赖</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/02/06/%E9%9A%8F%E7%AC%94/Markdown%E6%8F%92%E5%85%A5%E4%BB%A3%E7%A0%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="boom.Tan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Boom.Tan个人空间">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/06/%E9%9A%8F%E7%AC%94/Markdown%E6%8F%92%E5%85%A5%E4%BB%A3%E7%A0%81/" class="post-title-link" itemprop="url">Markdown</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-06 08:35:05" itemprop="dateCreated datePublished" datetime="2020-02-06T08:35:05+08:00">2020-02-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-02-11 16:49:15" itemprop="dateModified" datetime="2021-02-11T16:49:15+08:00">2021-02-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%9A%8F%E7%AC%94/" itemprop="url" rel="index"><span itemprop="name">随笔</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>前言:之前一直用富文本的编辑模式,但是对代码的支持不友好,因此练习了一下markdown,记录下来,对自己有个提醒,也希望能帮助到大家<a target="_blank" rel="noopener" href="https://segmentfault.com/markdown">更多技巧</a></p>
</blockquote>
<hr>
<p>#1.标题</p>
<p>#标题   —-&gt;  #标题<br>##标题   —-&gt;  ##标题<br>###标题   —-&gt;  ###标题<br>####标题   —-&gt;  ####标题<br>#####标题   —-&gt;  #####标题<br>######标题   —-&gt;  ######标题<br>目前支持六种标题大小<br>#2.引用<br>输入大于号后跟上文本,就像上面前言中显示的样式.eg: &gt;你好</p>
<blockquote>
<p>你好</p>
</blockquote>
<ul>
<li><h1 id="程序员版本"><a href="#程序员版本" class="headerlink" title="程序员版本"></a>程序员版本</h1><p>##3.1插入一行代码<br>首先我们另起一行,然后在行首连续输入两个”tab”键,跟上代码即可(<code>一定要另起一行</code>) tabtab db.addColumn(x.class,”test”);//新增的字段</p>
<p>  db.addColumn(x.class,”test”);//新增的字段<br>##3.2插入代码块<br>连续插入代码,我们需要连续输入三个符号 ```,后面可以跟上语言种类如java,然后代码块输入完毕,换行,在输入三个符号表示代码块结束 <code>键盘esc下面,波浪号的那个键</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//```java(某种编程语言)</span></span><br><span class="line"><span class="comment">//代码段</span></span><br><span class="line"><span class="comment">//```</span></span><br><span class="line"><span class="keyword">for</span> (Element e : c) &#123;</span><br><span class="line">    doSomething(e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//before JDK1.5</span></span><br><span class="line"><span class="keyword">for</span> (Iterator i = c.iterator(); i.hasNext(); ) &#123;</span><br><span class="line">    doSomething((Element) i.next());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面基本上可以满足程序员的基本要求了<br>##4.插入链接<br>在简书中的用法是<img src="https://upload-images.jianshu.io/upload_images/2226681-dca0142cb829876a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="链接语法.png"><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/829ed0e6010e">DDMS性能调优</a></p>
</blockquote>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/02/06/%E9%9A%8F%E7%AC%94/%E4%B8%8E%E7%88%B1%E6%83%85%E6%9C%89%E5%85%B3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="boom.Tan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Boom.Tan个人空间">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/06/%E9%9A%8F%E7%AC%94/%E4%B8%8E%E7%88%B1%E6%83%85%E6%9C%89%E5%85%B3/" class="post-title-link" itemprop="url">与爱情有关</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-06 08:35:05" itemprop="dateCreated datePublished" datetime="2020-02-06T08:35:05+08:00">2020-02-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-02-11 16:48:34" itemprop="dateModified" datetime="2021-02-11T16:48:34+08:00">2021-02-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%9A%8F%E7%AC%94/" itemprop="url" rel="index"><span itemprop="name">随笔</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="故事一"><a href="#故事一" class="headerlink" title="故事一"></a>故事一</h4><p> 我的下铺是一个五十多岁的中年男子，在公司为我们做饭。每天下班他都会和家里的小朋友视频，看着真是疼爱极了。但是我们每每周末回家的时候他都待在宿舍，一年半载也不回家一次。有天无意中提起他的婚姻，他笑着说：我已经离婚了。很突然，很意外。于是我问到，怎么会呢，你们看起来这么恩爱，这么顾家，什么原因导致的呢？</p>
<p>他说，我那个婆娘，一天到晚拿我跟别个老公比，终于有一天我也成别人老公了。</p>
<p> 也许在心中有了比较，彼此在心中的位置就空出来了吧</p>
<h4 id="故事二"><a href="#故事二" class="headerlink" title="故事二"></a>故事二</h4>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/02/06/%E9%9A%8F%E7%AC%94/%E6%81%95%E4%B8%8E%E5%BF%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="boom.Tan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Boom.Tan个人空间">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/06/%E9%9A%8F%E7%AC%94/%E6%81%95%E4%B8%8E%E5%BF%8D/" class="post-title-link" itemprop="url">恕与忍</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-06 08:35:05" itemprop="dateCreated datePublished" datetime="2020-02-06T08:35:05+08:00">2020-02-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-02-11 16:47:24" itemprop="dateModified" datetime="2021-02-11T16:47:24+08:00">2021-02-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%9A%8F%E7%AC%94/" itemprop="url" rel="index"><span itemprop="name">随笔</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>恕他人,忍自己</p>
<p>而今常态,忍他人,恕自己</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/02/06/%E9%9A%8F%E7%AC%94/%E7%8C%AA%E4%B8%8E%E5%91%BD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="boom.Tan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Boom.Tan个人空间">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/06/%E9%9A%8F%E7%AC%94/%E7%8C%AA%E4%B8%8E%E5%91%BD/" class="post-title-link" itemprop="url">猪与命</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-06 08:35:05" itemprop="dateCreated datePublished" datetime="2020-02-06T08:35:05+08:00">2020-02-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-02-11 16:48:59" itemprop="dateModified" datetime="2021-02-11T16:48:59+08:00">2021-02-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%9A%8F%E7%AC%94/" itemprop="url" rel="index"><span itemprop="name">随笔</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>人世间真的有命数吗?</p>
<p>一只猪再怎么拼命挣扎,努力奋斗也逃不过被人宰割的命运吧,可是当初它为什么选择猪圈呢?猪圈里的猪又生小猪猪,让小猪猪以为他们的命运也是如此,吃饱睡,睡饱吃,很安逸的一个圈,殊不知等待他们的都是同一个命运.</p>
<p>逃出这个舒适圈,跑到野地里去,要不了多久就会长出猎人也害怕的獠牙吧,纵使没有獠牙,也有一股难以屈服,拒绝任人宰割的野性吧</p>
<p>每个认为现在安逸环境的人身处的环境,难道不是一个圈吗?待到被命运宰割的时候,怎么嚎叫也无能为力.</p>
<p>可我们有自省和选择的权力,看清身边的处境,待命运之手来临时,狠狠的咬他一口,去他妈的命!!!</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/02/06/%E9%9A%8F%E7%AC%94/%E8%80%81%E6%9D%BF,%E9%A2%86%E5%AF%BC%E4%B8%8E%E5%91%98%E5%B7%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="boom.Tan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Boom.Tan个人空间">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/06/%E9%9A%8F%E7%AC%94/%E8%80%81%E6%9D%BF,%E9%A2%86%E5%AF%BC%E4%B8%8E%E5%91%98%E5%B7%A5/" class="post-title-link" itemprop="url">老板领导与员工</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-06 08:35:05" itemprop="dateCreated datePublished" datetime="2020-02-06T08:35:05+08:00">2020-02-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-02-11 16:46:54" itemprop="dateModified" datetime="2021-02-11T16:46:54+08:00">2021-02-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%9A%8F%E7%AC%94/" itemprop="url" rel="index"><span itemprop="name">随笔</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>老板:不需要在场证明<br>领导:不在场证明—开会<br>员工:详述论证一下不在场的证据,以证明这个锅不是你的</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/02/06/%E9%9A%8F%E7%AC%94/%E8%85%BE%E8%AE%AF%E5%A4%A7%E7%8E%8B%E5%8D%A1%E9%98%B2%E5%9D%91%E6%8C%87%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="boom.Tan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Boom.Tan个人空间">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/06/%E9%9A%8F%E7%AC%94/%E8%85%BE%E8%AE%AF%E5%A4%A7%E7%8E%8B%E5%8D%A1%E9%98%B2%E5%9D%91%E6%8C%87%E5%8D%97/" class="post-title-link" itemprop="url">腾讯大王卡防坑指南</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-06 08:35:05" itemprop="dateCreated datePublished" datetime="2020-02-06T08:35:05+08:00">2020-02-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-02-11 16:47:56" itemprop="dateModified" datetime="2021-02-11T16:47:56+08:00">2021-02-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%9A%8F%E7%AC%94/" itemprop="url" rel="index"><span itemprop="name">随笔</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>最近各种免流争相上市,出于要换号的考虑入手一张腾讯大王卡(联通),踩坑之路由此开始</p>
</blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/2226681-6da2ee755e612872.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="腾讯大王卡各套餐.jpg"><br>我选择的是19元/月的腾讯大王卡,刚过了一个月卡里的100元(首充50送50)余额不足了,于是下载了联通助手查询了下扣费,触目惊心</p>
<ul>
<li>坑一 流量<br>最大的坑之一<br>套外一元八百兆不是按月计算,而是按天计算<br>什么意思呢,看图说话</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/2226681-d9cf2ec0d82a1aa4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/2226681-a65d2ce09c2f7c44.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>一天超出几kb,不超过10兆的流量都是收0.1元/兆,约20兆的流量就收了0.9元<br>手机里哪怕不装非腾讯系的应用,也保不齐系统应用走的流量,每天一毛一个月就多了三块,每天一块一个月就多给了30块,加上月租一个月就是约50块了,一天超出八百兆,流量还额外扣费,无形之中话费就没了</p>
<ul>
<li>坑二 使用微信依然扣费</li>
</ul>
<p>现在的业务基本上都是资源整合的产品,微信里面的业务有的是接入的其他公司的流量,如”发现”当中的”看一看”,”钱包”里面的”第三方服务”等,这些内容走出来的流量依然要计费的</p>
<ul>
<li>坑三 不知晓的扣费<br>1号刚充了50,2号查看就少了5元,查询了一下联通的实时扣费,<br>如4G服务费,本地拨打本地电话费,国内本地流量费…属于消费者不知情的扣费项</li>
</ul>
<hr>
<p>#防坑心经</p>
<ul>
<li>现在的手机基本上能设置应用访问网络的权限,除了必须用的支付宝等,给其它应用设置为仅wifi下访问网络</li>
<li>使用腾讯系的产品也不要掉以轻心,因为你不知道访问的资源是腾讯的还是其他公司整合的,好在现在使用免流的应用会弹出提示”腾讯大王卡已为你免流”,如果你在使用腾讯系过程中没有看到类似的字眼,则要谨慎了</li>
<li>平时手机不用时将数据流量关闭,谨防系统应用或其它应用消耗流量</li>
<li>办理全国免流套餐吧,图便宜结果使用一个应用战战兢兢,如履薄冰,想哭哭不出来</li>
<li>有一点优势是免费入驻腾讯视频vip,相当于月租每月再交vip</li>
<li>#办理全国流量包重中之重,花了20办理了40G全国流量,腰也不酸了头也不疼了</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/02/06/Android%E6%97%A5%E8%AE%B0/Android%E5%9F%BA%E7%A1%80%E8%BF%9B%E9%98%B6%E4%B9%8BEffectiveJava%E7%BF%BB%E8%AF%91%E7%B3%BB%E5%88%97(%E7%AC%AC%E4%B9%9D%E7%AB%A0-%E5%B9%B6%E5%8F%91)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="boom.Tan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Boom.Tan个人空间">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/06/Android%E6%97%A5%E8%AE%B0/Android%E5%9F%BA%E7%A1%80%E8%BF%9B%E9%98%B6%E4%B9%8BEffectiveJava%E7%BF%BB%E8%AF%91%E7%B3%BB%E5%88%97(%E7%AC%AC%E4%B9%9D%E7%AB%A0-%E5%B9%B6%E5%8F%91)/" class="post-title-link" itemprop="url">Android基础进阶之EffectiveJava翻译系列(第九章-并发)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-06 08:35:05" itemprop="dateCreated datePublished" datetime="2020-02-06T08:35:05+08:00">2020-02-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-02-11 16:50:10" itemprop="dateModified" datetime="2021-02-11T16:50:10+08:00">2021-02-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android%E6%97%A5%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">Android日记</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <pre><code>线程允许多个任务同时执行.并发编程比单线程难,因为很多事情一起处理容易出错,也很难减少错误,但是你不能避免并发.这章帮助你编写简洁的,正确的,良好阅读性的并发编程
</code></pre>
<h5 id="Item66-同步共享的可变数据"><a href="#Item66-同步共享的可变数据" class="headerlink" title="Item66 同步共享的可变数据"></a>Item66 同步共享的可变数据</h5><p>​     synchronized 关键字可以保证一次只有一个线程访问代码块,许多开发者认为同步就是一种互斥,防止对象在另一个线程修改时处于不一致的状态.在这种观点中,对象处于一种正确的状态,因为访问它的方法锁住了.这些方法确保对象的状态由一种状态安全的转移到另一种状态.</p>
<p>​    这种观点只正确了一半,不同步的话,一个线程的改变对其它线程是不可见的.通过相同的锁,同步不仅阻止线程在不一致状态下观察对象，而且确保每个进入同步方法或块的线程都能看到所有一致性的效果.</p>
<p>​    考虑一下从一个线程停止另一个线程,Java lib提供了Thread.stop方法,但是这个方法被遗弃了,因为它是不安全的—将导致数据损坏.一种建议方法是获取到第一个线程的boolean变量,一些人可能会这么写:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//bad</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StopThread</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> stopRequested;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">	<span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">		Thread backgroundThread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">while</span> (!stopRequested)</span><br><span class="line">				i++;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">		backgroundThread.start();</span><br><span class="line">		TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">		stopRequested = <span class="keyword">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>​    你可能期望这个程序运行大约一秒，然后主线程设置stopRequested为true，从而导致后台线程的循环终止 .然而在我的机器上，程序永远不会停：子线程永远在循环！</p>
<p>​    问题在于，在没有同步的情况下，无法保证后台线程何时会看到主进程所做的修改. 在没有同步的情况下，虚拟机转换成以下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (!done)</span><br><span class="line">	i++;</span><br><span class="line"><span class="comment">//转换</span></span><br><span class="line"><span class="keyword">if</span> (!done)</span><br><span class="line">	<span class="keyword">while</span> (<span class="keyword">true</span>)</span><br><span class="line">		i++;</span><br></pre></td></tr></table></figure>
<p>修复方式如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//good</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StopThread</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> stopRequested;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">requestStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		stopRequested = <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">boolean</span> <span class="title">stopRequested</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> stopRequested;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">	<span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">		Thread backgroundThread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">				<span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">				<span class="keyword">while</span> (!stopRequested())</span><br><span class="line">					i++;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">		backgroundThread.start();</span><br><span class="line">		TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">		requestStop();</span><br><span class="line">	&#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>​    <strong>注意:读和写都是同步的,光对写方法同步,同步会失效</strong></p>
<p>还可以使用volatile关键字修复为:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StopThread</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> stopRequested;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">		<span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">			Thread backgroundThread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">				<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">					<span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">					<span class="keyword">while</span> (!stopRequested)</span><br><span class="line">						i++;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;);</span><br><span class="line">			backgroundThread.start();</span><br><span class="line">			TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">			stopRequested = <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但使用volatile关键字要小心,考虑如下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//bad</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keyword">int</span> nextSerialNumber = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">generateSerialNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> nextSerialNumber++;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>乍看之下没有什么问题,但是”++”操作不是原子性的,包含了两个操作,一个是读旧值,另一个是在旧值的基础上加一,在赋值.修复方式为加上synchronized关键字:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//good</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keyword">int</span> nextSerialNumber = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">generateSerialNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> nextSerialNumber++;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>​    避免此类问题最好的方式是不要共享可变数据.要么共享不可变的数据,要么就不共享.换句话说,**在一个线程中定义可变数据.**如果采用此策略，则必须将其文档化，以便程序维护此原则</p>
<blockquote>
<p>总之,当多个线程共享数据时，读取或写入数据的每个线程都必须执行同步.没有同步,无法保证一个线程的修改对另一个线程可见.这将会导致程序安全问题,而且很难调试.如果你只需要内部间的线程通信而不考虑互斥, volatile 关键字可以替代synchronized,但是volatile很难被正确使用</p>
</blockquote>
<hr>
<h5 id="Item-67-避免过度同步"><a href="#Item-67-避免过度同步" class="headerlink" title="Item 67: 避免过度同步"></a>Item 67: 避免过度同步</h5><p>Item66警示了不使用同步的危险性,Item 67讨论完全相反的一面.在某种情况下,过度使用同步会导致性能下降,死锁或者不可预期的行为</p>
<p>为了避免重复和安全故障，千万不要在同步方法或块内控制客户端.换句话说,不要再同步方法中调用需要重写的方法或者从客户端提供的对象方法(这种方法被称为”外星人”).因为同步块不知道这个方法是干什么的也不能控制这个客户端,调用它将会导致异常或者数据损坏</p>
<p>考虑如下的”外星人”代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//bad Broken - invokes alien method from synchronized block!</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ObservableSet</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">ForwardingSet</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ObservableSet</span><span class="params">(Set&lt;E&gt; set)</span> </span>&#123; <span class="keyword">super</span>(set); &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> List&lt;SetObserver&lt;E&gt;&gt; observers = </span><br><span class="line">                    <span class="keyword">new</span> ArrayList&lt;SetObserver&lt;E&gt;&gt;();</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addObserver</span><span class="params">(SetObserver&lt;E&gt; observer)</span> </span>&#123;</span><br><span class="line">  	  <span class="keyword">synchronized</span>(observers) &#123;</span><br><span class="line">		  observers.add(observer);</span><br><span class="line">	  &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">removeObserver</span><span class="params">(SetObserver&lt;E&gt; observer)</span> </span>&#123;</span><br><span class="line">	  <span class="keyword">synchronized</span>(observers) &#123;</span><br><span class="line">		  <span class="keyword">return</span> observers.remove(observer);</span><br><span class="line">	  &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">notifyElementAdded</span><span class="params">(E element)</span> </span>&#123;</span><br><span class="line">	  <span class="keyword">synchronized</span>(observers) &#123;</span><br><span class="line">		<span class="keyword">for</span> (SetObserver&lt;E&gt; observer : observers)</span><br><span class="line">			observer.added(<span class="keyword">this</span>, element);</span><br><span class="line">	  &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E element)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">boolean</span> added = <span class="keyword">super</span>.add(element);</span><br><span class="line">	<span class="keyword">if</span> (added)</span><br><span class="line">		notifyElementAdded(element);</span><br><span class="line">	<span class="keyword">return</span> added;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">boolean</span> result = <span class="keyword">false</span>;</span><br><span class="line">	<span class="keyword">for</span> (E element : c)</span><br><span class="line">		result |= add(element); </span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>observers通过addObserver/removeObserver 订阅/取消订阅,但是SetObserver<E> observer被传递进来了:</E></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SetObserver</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">	<span class="comment">// Invoked when an element is added to the observable set</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">added</span><span class="params">(ObservableSet&lt;E&gt; set, E element)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>在测试运行时,上述代码似乎运行良好,如打印0~99:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	ObservableSet&lt;Integer&gt; set =</span><br><span class="line">		<span class="keyword">new</span> ObservableSet&lt;Integer&gt;(<span class="keyword">new</span> HashSet&lt;Integer&gt;());</span><br><span class="line">	set.addObserver(<span class="keyword">new</span> SetObserver&lt;Integer&gt;() &#123;</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">added</span><span class="params">(ObservableSet&lt;Integer&gt; s, Integer e)</span> </span>&#123;</span><br><span class="line">		System.out.println(e)</span><br><span class="line">	&#125;&#125;);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++)</span><br><span class="line">		set.add(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在我们来做一点改变:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">set.addObserver(<span class="keyword">new</span> SetObserver&lt;Integer&gt;() &#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">added</span><span class="params">(ObservableSet&lt;Integer&gt; s, Integer e)</span> </span>&#123;</span><br><span class="line">		System.out.println(e);</span><br><span class="line">		<span class="keyword">if</span> (e == <span class="number">23</span>) s.removeObserver(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>我们会期望打印出0-23,实际上会发生什么呢,打印出0~23后接着会报ConcurrentModificationException.因为我们正在移除集合中的元素,此时notifyElementAdded正在遍历集合</p>
<p>解决方法是:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//good 将&quot;外星人&quot;代码移除同步块</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">notifyElementAdded</span><span class="params">(E element)</span> </span>&#123;</span><br><span class="line">	List&lt;SetObserver&lt;E&gt;&gt; snapshot = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">synchronized</span>(observers) &#123;</span><br><span class="line">		snapshot = <span class="keyword">new</span> ArrayList&lt;SetObserver&lt;E&gt;&gt;(observers);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (SetObserver&lt;E&gt; observer : snapshot)</span><br><span class="line">		observer.added(<span class="keyword">this</span>, element);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>事实上,有一种更好的方式移除同步代码中的外星人代码,在JDK1.5之后,Java提供了一系列并发集合,如 CopyOnWriteArrayList刚好可以解决上面的问题,很适合于观察者模式:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//good Thread-safe observable set with CopyOnWriteArrayList</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> List&lt;SetObserver&lt;E&gt;&gt; observers = </span><br><span class="line">	<span class="keyword">new</span> CopyOnWriteArrayList&lt;SetObserver&lt;E&gt;&gt;();</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addObserver</span><span class="params">(SetObserver&lt;E&gt; observer)</span> </span>&#123;</span><br><span class="line">	observers.add(observer);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">removeObserver</span><span class="params">(SetObserver&lt;E&gt; observer)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> observers.remove(observer);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">notifyElementAdded</span><span class="params">(E element)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (SetObserver&lt;E&gt; observer : observers)</span><br><span class="line">		observer.added(<span class="keyword">this</span>, element);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第一部分讨论了正确性,现在我们看看性能.在多核时代,过度同步的开销并不在CPU获取锁身上,真正的开销在于平行执行的机会和多个核心CPU保持一致的内存记忆模型.过度同步另一个隐藏的开销是减少了虚拟机优化代码块的执行</p>
<p>并发使用的前提是保证可变对象线程安全,我们仅仅需要在需要同步的地方同步,而不是将整个对象同步.因为这个原因,在1.5的版本,StringBuffer被StringBuild替代了,不要将整个对象同步,而仅仅告知它是非线程安全对象,然后客户端调用的时候在做适当处理</p>
<blockquote>
<p>总之,为了避免死锁和数据损坏,不要写”外星人”代码,尽量减少同步块中的工作量.在多核时代,更重要的是不使用同步.当你需要设计一个可变类的时候,好好想想在该同步的地方同步,不要过度</p>
</blockquote>
<hr>
<h5 id="Item-68-使用Java或者Android平台提供好的线程工具类"><a href="#Item-68-使用Java或者Android平台提供好的线程工具类" class="headerlink" title="Item 68:使用Java或者Android平台提供好的线程工具类"></a>Item 68:使用Java或者Android平台提供好的线程工具类</h5><p>不要直接使用thread,因为它控制不住</p>
<p>在JDK1.5中,java.util.concurrent提供了基于接口的任务类框架Executor,创建了一种更好的工作流方式:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService executor = Executors.newSingleThreadExecutor();</span><br><span class="line">executor.execute(runnable);<span class="comment">//执行</span></span><br><span class="line">executor.shutdown();<span class="comment">//优雅的通知停止</span></span><br></pre></td></tr></table></figure>


<p>你可以用ExecutorService做很多事情,比如你可以等待特定任务完成,可以等待任务停止(用awaitTermination方法)等等</p>
<p>如果你想多个线程做任务队列里的工作,可以通过线程池创建不同的ExecutorService.  java.util.concurrent.Executors提供了很多你需要的静态工厂方法,你也可以直接使用 ThreadPoolExecutor.</p>
<p>对特定的任务选择合适的线程池.如果你想写一个小的轻量级的加载服务,用Executors.newCachedThreadPool是一个很好的选择.但是这个线程池不适合做很重的操作,Executors.newFixedThreadPool是一个很好的选择,内部维护了一个固定数量的线程.</p>
<p>完整的Executor介绍超出了本书的内容,有兴趣可以参考<Java concurrency in practice></Java></p>
<hr>
<h5 id="Item-69-使用并发工具类代替wait和notify"><a href="#Item-69-使用并发工具类代替wait和notify" class="headerlink" title="Item 69: 使用并发工具类代替wait和notify"></a>Item 69: 使用并发工具类代替wait和notify</h5><p>随着1.5版本的诞生,wait和notify使用越来越少了,因为Java平台提供了高效的并发工具类</p>
<p>在java.util.concurrent提供了三种工具类</p>
<p>1.前面介绍的Executor框架</p>
<p>2.并发集合</p>
<p>3.同步器</p>
<p>并发集合提供了基于标准集合接口(如List,Queue,Map)的高性能并发,为了实现高并发,这些接口管理内部的同步.因此在不需要并发的情况下不要使用这些集合,因为访问锁的原因减慢了程序运行</p>
<p>这意味着客户端不能原子性的使用并发集合组合方法,因此有一些接口集成了基于状态修改的操作来提供原子性.如,ConcurrentMap 集成 Map并添加了自己的方法如putIfAbsent(key,value)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//未优化</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ConcurrentMap&lt;String, String&gt; map = </span><br><span class="line">	<span class="keyword">new</span> ConcurrentHashMap&lt;String, String&gt;();</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">intern</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">	String previousValue = map.putIfAbsent(s, s);</span><br><span class="line">	<span class="keyword">return</span> previousValue == <span class="keyword">null</span> ? s : previousValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>事实上,有一种更好的方式,ConcurrentHashMap优化过检索操作,如get.因此:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//优化后,运行更快</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">intern</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> startNanos = System.nanoTime();</span><br><span class="line">	String result = map.get(s);</span><br><span class="line">	<span class="keyword">if</span> (result == <span class="keyword">null</span>) &#123;</span><br><span class="line">		result = map.putIfAbsent(s, s);</span><br><span class="line">		<span class="keyword">if</span> (result == <span class="keyword">null</span>)</span><br><span class="line">			result = s;</span><br><span class="line">	&#125;</span><br><span class="line">    Log.d(<span class="string">&quot;time&quot;</span>,<span class="string">&quot;spend &quot;</span>+System.nanoTime() - startNanos);</span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于间隔计时来说,建议使用System.nanoTime(),它比 System.currentTimeMillis更精确,而且不受系统时间调整的影响</p>
<p>虽然你总是应该使用并发工具,但是你可能有时会用到wait和notify.标准的调用wait方法模板如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The standard idiom for using the wait method</span></span><br><span class="line"><span class="keyword">synchronized</span> (obj) &#123;</span><br><span class="line">	<span class="keyword">while</span> (&lt;condition does not hold&gt;)</span><br><span class="line">		obj.wait(); <span class="comment">// (Releases lock, and reacquires on wakeup)</span></span><br><span class="line">	... <span class="comment">// Perform action appropriate to condition</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>永远在循环内部调用wait方法</strong>,循环会在wait之前或之后检查条件是否成立</p>
<p>相关问题是是否应使用“notify”或“notifyAll”来唤醒等待线程.（重复调用notify只会唤醒一个等待的线程,notifyAll会唤醒所有的等待线程.).有一个合理的，保守的建议说你应该始终使用NotifyAll,它总是会产生正确的结果，因为它保证唤醒线程,可能也会唤醒其他线程，但这不会影响程序的正确性.这些线程将检查它们等待的条件，发现不满足，将继续等待</p>
<p>作为一种优化来讲,你应该选择notify.如果所有的线程都在等待同一个条件,notify保证同一时间只有一个线程的条件为真</p>
<blockquote>
<p>总之,直接使用wait和notify的情况已经很少了,如果需要用的话请参考上面的模板并确保线程间的一致性</p>
</blockquote>
<hr>
<h5 id="Item-70-Document-thread-safety"><a href="#Item-70-Document-thread-safety" class="headerlink" title="Item 70: Document thread safety"></a>Item 70: Document thread safety</h5><p>文档注释清楚线程安全性</p>
<p>一个类的行为怎么样,有很重要一部分取决于客户端.如果你没有声明清楚一个类的方法,用这个类的程序员将会被迫做出一些假设.如果这些假设是错误的,结果不言自明.</p>
<p><strong>线程安全等级有很多种,一个类必须注释好它支持的线程安全等级</strong></p>
<p>以下列出了部分线程安全等级:</p>
<ul>
<li><p>immutable-不可变的,这个类的实例输出常量,没有必要在外部同步,如String,BigInteger</p>
</li>
<li><p>unconditional thread-safe-无条件线程安全,这个类的实例是可变的,但是内部处理了用于并发的同步,所以也没有必要外部同步,如Random,ConcurrentHashMap</p>
</li>
<li><p>conditionally thread-safe-同无条件线程安全一样,除非一些方法为了并发需要外部同步.如Collections.synchronized返回的集合使用iterators需要外部同步</p>
</li>
<li><p>not thread-safe-线程不安全,这个类的实例是可变的.并发使用的情况下调用端需要对每个方法都同步.如ArrayList,HashMap</p>
</li>
<li><p>thread-hostile-线程敌对,很少使用.即使使用了外部同步依然是线程不安全的.如System.runFinalizersOnExit(已经被遗弃)</p>
</li>
</ul>
<p>文档注释条件线程安全类需要小心.你必须声明哪些调用序列需要外部同步,调用序列都需要哪些锁对象.很典型的情况锁对象是实例本身,但是也有例外.如果一个对象持有了另一个view的引用,调用端需要对返回的对象同步,防止对象对view做修改.例如:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;K, V&gt; m = Collections.synchronizedMap(<span class="keyword">new</span> HashMap&lt;K, V&gt;());</span><br><span class="line">...</span><br><span class="line">Set&lt;K&gt; s = m.keySet(); <span class="comment">// 不需要放在同步块中</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">synchronized</span>(m) &#123; <span class="comment">// 同步m 而不是s</span></span><br><span class="line">	<span class="keyword">for</span> (K key : s)</span><br><span class="line">		key.f();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当一个类提交使用一个可公开访问的锁时，它使客户端能够执行一系列的方法修改，但是这种灵活性是要付出代价的.它不兼容高性能的并发集合排序控制,如ConcurrentHashMap或ConcurrentLinkedQueue.此外，客户端可以通过长期持有公开访问锁制造”服务拒绝”攻击. 这可以是偶然的,也可以是有意的.</p>
<p>为了防止”服务拒绝”攻击,你应该使用私有对象锁来代替同步块:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Object lock = <span class="keyword">new</span> Object();<span class="comment">//避免&quot;服务拒绝&quot;攻击</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">synchronized</span>(lock) &#123;</span><br><span class="line">	...</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意lock是用final修饰的,防止修改了锁的内容</p>
<p>值得重申的是,私有对象锁只能用于无条件线程安全类,因为条件线程安全类需要在调用方法的时候声明需要获取的锁对象.</p>
<blockquote>
<p>总之,每一个类应该文档注释它的线程安全属性</p>
</blockquote>
<hr>
<h5 id="Item-71-Use-lazy-initialization-judiciously"><a href="#Item-71-Use-lazy-initialization-judiciously" class="headerlink" title="Item 71: Use lazy initialization judiciously"></a>Item 71: Use lazy initialization judiciously</h5><p>明智地使用延迟初始化</p>
<p>延迟初始化是为了在需要用到值的地方初始化.如果这个值从不需要,这个实例也从不会初始化.延迟初始化是一种优化策略,也可以用来打破实例初始化的有害循环.</p>
<p>对大部分的优化来说,最好的建议是<strong>不要优化,除非你不得不做</strong></p>
<p>,延迟初始化是一把双刃剑.它降低了初始化一个类的代价,却增加了访问这种字段的代价.如下情况会损害性能:需要延迟加载字段在类当中使用占比,用于初始化的代价有多大,访问有多频繁.</p>
<p>也就是说,延迟初始化有其用途.如果一个字段仅在类实例的一小部分上被访问,并且初始化该字段的代价很高,那么延迟初始化可能是值得的.唯一确定的方法是测量有和没有延迟初始化的类的性能.</p>
<p>在大多数的文章中,都<strong>建议使用普通初始化</strong>.下面是典型的普通初始化声明:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> FieldType field = computeFieldValue();</span><br></pre></td></tr></table></figure>
<p>如果你想使用延迟初始化来中断初始化循环,使用synchronized关键字:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Lazy initialization of instance field - synchronized accessor</span></span><br><span class="line"><span class="keyword">private</span> FieldType field;</span><br><span class="line"><span class="function"><span class="keyword">synchronized</span> FieldType <span class="title">getField</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (field == <span class="keyword">null</span>)</span><br><span class="line">		field = computeFieldValue();</span><br><span class="line">	<span class="keyword">return</span> field;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当你需要使用延迟初始化来提高性能,有如下三种模型</p>
<ul>
<li>静态字段,使用延迟初始化holder模型</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Lazy initialization holder class idiom for static fields</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">FieldHolder</span> </span>&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">final</span> FieldType field = computeFieldValue();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> FieldType <span class="title">getField</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> FieldHolder.field; &#125;</span><br></pre></td></tr></table></figure>
<p>当getField()方法第一次被调用,它会读FieldHolder.field</p>
<p>,导致FieldHolder类初始化.这种模式的美妙之处在于getField()不需要同步修饰而且只执行字段访问,所以延迟初始化不会增加访问的开销.</p>
<ul>
<li>实例字段,使用双重检查模型</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> FieldType field;</span><br><span class="line"><span class="function">FieldType <span class="title">getField</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	FieldType result = field;</span><br><span class="line">	<span class="keyword">if</span> (result == <span class="keyword">null</span>) &#123; <span class="comment">// First check (no locking)</span></span><br><span class="line">		<span class="keyword">synchronized</span>(<span class="keyword">this</span>) &#123;</span><br><span class="line">			result = field;</span><br><span class="line">			<span class="keyword">if</span> (result == <span class="keyword">null</span>) <span class="comment">// Second check (with locking)</span></span><br><span class="line">				field = result = computeFieldValue();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码可能看起来有点复杂.特别是对局部变量结果可能不明确.此变量所做的是确保字段在它已经初始化的情况下只读取一次.虽然这并不是绝对必要的,但它可能会提高性能,并且按照适用于低级别并发编程的标准来说更加优雅.在我的机器上,上面的方法比没有局部变量的版本明显快25%。</p>
<p>在JDK1.5之前,双重检查模型不能很好的工作,因为volatile关键字不够强壮来支撑它.之后的版本修复了这个问题.当然你也可以用这种方式来延迟初始化静态实例,但holder模型对于静态实例是最好的选择</p>
<ul>
<li>实例字段,不介意重复初始化,使用单检查模型</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Single-check idiom - can cause repeated initialization!</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> FieldType field;</span><br><span class="line"><span class="function"><span class="keyword">private</span> FieldType <span class="title">getField</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	FieldType result = field;</span><br><span class="line">	<span class="keyword">if</span> (result == <span class="keyword">null</span>) </span><br><span class="line">		field = result = computeFieldValue();</span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上不仅仅可以用于实例,也可以用于Object</p>
<blockquote>
<p>总之,你应该正常地初始化大多数字段,而不是延迟加载.如果必须延迟初始化字段以实现性能目标,或打破有害的初始化循环.有如上三种模型做参考.</p>
</blockquote>
<hr>
<h5 id="Item-72-Don’t-depend-on-the-thread-scheduler"><a href="#Item-72-Don’t-depend-on-the-thread-scheduler" class="headerlink" title="Item 72: Don’t depend on the thread scheduler"></a>Item 72: Don’t depend on the thread scheduler</h5><p>不要依赖线程调度</p>
<p>当许多线程运行时,线程调度决定哪些线程要运行,以及运行多长时间.任何合理的操作系统都将试图公平地做出这种判断,但是策略可以不同.因此,编写好的程序不应该取决于策略细节.任何依赖线程调度器进行正确性或性能的程序很可能是不可移植的</p>
<p>写一个强健的,响应快的,可移植的程序最好的方式是确保可运行的线程数量不明显超过处理器的数量.这样程序的行为在不同的策略下也没有太大变化.注意,可运行线程的数量不等同于线程总数.处于wait状态下的线程是非运行线程.</p>
<p>减少可运行线程数量的主要技术是让每个线程做一些有用的工作,然后等待更多的线程.如果线程没有做有用的工作,它们就不应该运行.在Executor Framework(Item68)中,这意味着适当地调整线程池的大小,并保持任务相当小且相互独立.任务不应该太小否则调度开销会损害性能</p>
<blockquote>
<p>总之,不要依赖线程调度来确保程序的正确性.也不要依赖Thread.yield或线程优先级.线程优先级可能被谨慎地用于提高已经工作的程序的服务质量,但是绝不能用来”修复”无法工作的程序.</p>
</blockquote>
<hr>
<h5 id="Item-73-Avoid-thread-groups"><a href="#Item-73-Avoid-thread-groups" class="headerlink" title="Item 73: Avoid thread groups"></a>Item 73: Avoid thread groups</h5><p>避免使用线程组</p>
<p>线程组并没有提供很多有用的功能,而且它们提供的许多功能都存在缺陷.线程组最好被看作是一个失败的实验.你应该忽略它们的存在.如果你设计了一个处理逻辑线程组的类,那么你应该使用线程池来替代</p>
<hr>
<blockquote>
<p>?为什么xml布局中,使用了layout_weight=”1”,会提示将宽/高设为0dp?</p>
</blockquote>
<p>本章完<br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/009327a97ae9">第八章:异常</a>   </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/02/03/%E6%97%B6%E9%97%B4/2018--%E4%B8%80%E6%9C%8824%E5%8F%B7%E5%88%B0%E4%B8%80%E6%9C%8828%E5%8F%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="boom.Tan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Boom.Tan个人空间">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/02/03/%E6%97%B6%E9%97%B4/2018--%E4%B8%80%E6%9C%8824%E5%8F%B7%E5%88%B0%E4%B8%80%E6%9C%8828%E5%8F%B7/" class="post-title-link" itemprop="url">2018/0124~0128</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-02-03 08:35:05" itemprop="dateCreated datePublished" datetime="2018-02-03T08:35:05+08:00">2018-02-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-02-22 17:23:29" itemprop="dateModified" datetime="2021-02-22T17:23:29+08:00">2021-02-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%97%B6%E9%97%B4/" itemprop="url" rel="index"><span itemprop="name">时间</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="本周总结-总共时间10080分钟"><a href="#本周总结-总共时间10080分钟" class="headerlink" title="本周总结 总共时间10080分钟"></a>本周总结 总共时间10080分钟</h3><h5 id="1-总体计划概要"><a href="#1-总体计划概要" class="headerlink" title="1.总体计划概要"></a>1.总体计划概要</h5><ul>
<li>工作时长:2335分钟</li>
<li>学习:95分钟</li>
<li> 交通:437分钟</li>
<li>陪伴家人:2160分钟</li>
<li>日常(洗漱,洗澡等):247分钟</li>
<li>睡眠:2940分钟<br>#####2.计划本周目标及完成情况<br>学习420分钟,未达成<br>#####3.完成情况原因分析<br>冬天开始睡懒觉,晚上看上了吃鸡直播,没有按时睡觉,闹钟响后没有第一时间起床,结果导致没有时间学习<br>#####4.后续计划<br>按时睡觉按时起床,每天早上观看一小时谷歌官方文章,晚上查看车机系统是如何搭成的<br>继续提高专业能力</li>
</ul>
<h5 id="本周做得完善的地方"><a href="#本周做得完善的地方" class="headerlink" title="本周做得完善的地方"></a>本周做得完善的地方</h5><p>学会了Source Insight 4.0的基本用法<br>工作上基本完成</p>
<h5 id="值得改进的地方"><a href="#值得改进的地方" class="headerlink" title="值得改进的地方"></a>值得改进的地方</h5><p>每天晚上玩手机的时间太多了,影响了睡眠,进而影响了学习.<br>给家人打电话的时间变少了,争取每周打一通电话</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/9/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/11/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">boom.Tan</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">101</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">boom.Tan</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
